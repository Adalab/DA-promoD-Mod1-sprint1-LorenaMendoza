CREATE SCHEMA sports_analytics;
USE sports_analytics;

#CREACIÓN DE TABLA

CREATE TABLE season(
season_id BIGINT,
season VARCHAR(30),
PRIMARY KEY (season_id));

CREATE TABLE teams(
team_id BIGINT,
team VARCHAR(45),
PRIMARY KEY (team_id));

CREATE TABLE stats(
id_stat_team_season BIGINT,
team_id BIGINT,
season_id BIGINT,
gp INT,
w INT,
l INT,
win_percent FLOAT,
minutes TIME,
pts FLOAT,
fgm FLOAT,
fga FLOAT,
fg_percent FLOAT,
three_pm FLOAT,
three_pa FLOAT,
three_point_percent FLOAT,
ftm FLOAT,
fta FLOAT,
ft_percent FLOAT,
oreb FLOAT,
dreb FLOAT,
reb FLOAT,
ast FLOAT,
tov FLOAT,
stl FLOAT,
blk FLOAT,
blka FLOAT,
pf FLOAT,
pfd FLOAT,
plus_minus FLOAT,
PRIMARY KEY (id_stat_team_season));

#INSERCIÓN DE DATOS 

INSERT INTO `season`(season_id, season)
	VALUES (140409122677552,"2020-2021"),
	   (140409122677808,"2019-2020"),
	   (140409122678320,"2017-2018"),
       (140409122678576,"2016-2017");
       
INSERT INTO `teams`(team_id, team)
	VALUES (140409122658096,	"Atlanta Hawks"),
(140409122658352,	"Boston Celtics"),
(140409122658608,	"Brooklyn Nets"),
(140409122660800,	"Charlotte Hornets"),
(140409122659056,	"Chicago Bulls"),
(140409122661200,	"Cleveland Cavaliers"),
(140409122661440,	"Dallas Mavericks"),
(140409122659696,	"Denver Nuggets"),
(140409122659952,	"Detroit Pistons"),
(140409122662000,	"Golden State Warriors"),
(140409122664560,	"Houston Rockets"),
(140409122664816,	"Indiana Pacers"),
(140409122665072,	"LA Clippers"),
(140409122662720,	"Los Angeles Lakers"),
(140409122662960,	"Memphis Grizzlies"),
(140409122665712,	"Miami Heat"),
(140409122665968,	"Milwaukee Bucks"),
(140409122663520,	"Minnesota Timberwolves"),
(140409122663760,	"New Orleans Pelicans"),
(140409122666608,	"New York Knicks"),
(140409122664160,	"Oklahoma City Thunder"),
(140409122667056,	"Orlando Magic"),
(140409122672848,	"Philadelphia 76ers"),
(140409122667504,	"Phoenix Suns"),
(140409122673248,	"Portland Trail Blazers"),
(140409122673488,	"Sacramento Kings"),
(140409122673728,	"San Antonio Spurs"),
(140409122668336,	"Toronto Raptors"),
(140409122676848,	"Utah Jazz"),
(140409122674288,	"Washington Wizards");

INSERT INTO `stats` (id_stat_team_season, team_id, season_id, gp, w, l, win_percent, minutes, pts, fgm, fga, fg_percent, three_pm, three_pa, three_point_percent, ftm, fta, ft_percent, oreb, dreb, reb, ast, tov, stl, blk, blka, pf, pfd, plus_minus)
	VALUES (280818245335648,140409122658096,140409122677552,72,41,31,0.569,48.3,113.7,40.8,87.2,46.8,12.4,33.4,37.3,19.7,24.2,81.2,10.6,35.1,45.6,24.1,13.2,7,4.8,5,19.3,19.8,2.3),
(280818245335905,140409122658352,140409122677552,72,36,36,0.5,48.3,112.6,41.5,88.9,46.6,13.6,36.4,37.4,16.1,20.8,77.5,10.6,33.6,44.3,23.5,14.1,7.7,5.3,4.6,20.4,19.3,1.5),
(280818245335934,140409122658096,140409122677808,67,20,47,0.299,48.6,111.8,40.6,90.6,44.9,12,36.1,33.3,18.5,23.4,79,9.9,33.4,43.3,24,16.2,7.8,5.1,6.4,23.1,21,-8),
(280818245336162,140409122658608,140409122677552,72,48,24,0.667,48.3,118.6,43.1,87.3,49.4,14.2,36.1,39.2,18.1,22.5,80.4,8.9,35.5,44.4,26.8,13.5,6.7,5.3,4.6,19,18.9,4.5),
(280818245336191,140409122658352,140409122677808,72,48,24,0.667,48.4,113.7,41.3,89.6,46.1,12.6,34.5,36.4,18.6,23.2,80.1,10.7,35.4,46.1,23,13.8,8.3,5.6,5.5,21.6,20.7,6.3),
(280818245336220,140409122658096,140409122678064,82,29,53,0.354,48.4,113.3,41.4,91.8,45.1,13,37,35.2,17.6,23.4,75.2,11.6,34.5,46.1,25.8,17,8.2,5.1,5.5,23.6,22.2,-6),
(280818245336448,140409122658608,140409122677808,72,35,37,0.486,48.6,111.8,40.4,90.3,44.8,13.1,38.1,34.3,17.9,24.1,74.5,10.6,37.3,47.9,24.5,15.3,6.4,4.5,5.3,21,21.1,-0.6),
(280818245336477,140409122658352,140409122678064,82,49,33,0.598,48.2,112.4,42.1,90.5,46.5,12.6,34.5,36.5,15.6,19.5,80.2,9.8,34.7,44.5,26.3,12.8,8.6,5.3,3.9,20.4,19.5,4.4),
(280818245336506,140409122658096,140409122678320,82,24,58,0.293,48.1,103.4,38.2,85.5,44.6,11.2,31,36,15.8,20.2,78.5,9.1,32.8,41.9,23.7,15.5,7.8,4.2,5.5,19.6,20.3,-5.5),
(280818245336612,140409122659056,140409122677552,72,31,41,0.431,48.3,110.7,42.2,88.6,47.6,12.6,34,37,13.8,17.5,79.1,9.6,35.3,45,26.8,15.1,6.7,4.2,5.1,18.9,17.7,-0.9),
(280818245336734,140409122658608,140409122678064,82,42,40,0.512,48.7,112.2,40.3,89.7,44.9,12.8,36.2,35.3,19,25.5,74.5,11,35.6,46.6,23.8,15.1,6.6,4.1,5.3,21.5,22,-0.1),
(280818245336763,140409122658352,140409122678320,82,55,27,0.671,48.3,104,38.3,85.1,45,11.5,30.4,37.7,16,20.7,77.1,9.4,35.1,44.5,22.5,14,7.4,4.5,4.4,19.7,19.2,3.6);
    
#COMO AL INICIO NO ME PERMITÍA INSERTAR DATOS, DECIDÍ ESTABLECER LAS FK DESPUÉ
	
## ESTA PRIMERA FK PUDE AÑADIRLA SIN PROBLEMA
    
ALTER TABLE stats    
   ADD CONSTRAINT `fk_stats_teams`
		FOREIGN KEY (team_id)
		REFERENCES teams (team_id) 
        ON DELETE CASCADE ON UPDATE CASCADE;

## CON ESTA SEGUNDA FK TUVE PROBLEMAS (ERROR 1452), PUES FALTABA UN DATO ENTRE LOS DATOS A LA HORA DE COMPLETAR
## LA INSERCIÓN. SE TRATABA DE UNA PK Y POR ELLO NO PERMITÍA LA INSERCIÓN DE DATOS COMPLETA EN LA TABLA STATS, PUES LA REFERENCIA 
#ERA NECESARIA PARA CREAR LA FK EN ESTA ÚLTIMA TABLA.

ALTER TABLE stats    
   ADD CONSTRAINT `fk_stats_season`
		FOREIGN KEY (season_id)
		REFERENCES season (season_id) 
        ON DELETE CASCADE ON UPDATE CASCADE;

#PARA SOLUCIONAR EL PROBLEMA ME FUI A LA TABLA SEASON Y REALICÉ LA SIGUIENTE BÚSQUEDA PARA
#VER DÓNDE ESTABA EL ERROR.

SELECT DISTINCT *
FROM season;

#PUDE OBSERVAR QUE HABÍA UNA PK SIN COMPLETAR, ES DECIR. 
#LA POSTERIOR BÚSQUEDA LA HICE DE FORMA MANUAL, YA QUE POR SUERTE, TAMPOCO ERA UNA BBDD MUY GRANDE.
#A CONTINUACIÓN, TRAS DETECTAR EL PROBLEMA, REALICÉ LA INSERCIÓN DEL DATO FALTANTE.

INSERT INTO `season`(season_id, season)
VALUES ("140409122678064", "desconocida");

#PUDE ESTABLECER LA SEGUNDA FK Y TENER LA BASE DE DATOS LISTA.

